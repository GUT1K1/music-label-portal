<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>VK Authorization</title>
</head>
<body>
    <script>
        console.log('üü¢ VK callback page loaded');
        console.log('üü¢ Full URL:', window.location.href);
        
        // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const payload = urlParams.get('payload');
        
        if (payload) {
            try {
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º payload
                const data = JSON.parse(decodeURIComponent(payload));
                console.log('üü¢ VK payload:', data);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –æ–∫–Ω—É
                if (window.opener) {
                    window.opener.postMessage({
                        code: data.code,
                        state: data.state,
                        device_id: data.device_id
                    }, window.location.origin);
                    
                    console.log('üü¢ Data sent to parent window');
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ —á–µ—Ä–µ–∑ 500–º—Å
                    setTimeout(() => {
                        window.close();
                    }, 500);
                }
            } catch (error) {
                console.error('üî¥ Error parsing payload:', error);
            }
        } else {
            // –ï—Å–ª–∏ payload –Ω–µ—Ç, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–ø—Ä—è–º—É—é
            const code = urlParams.get('code');
            const state = urlParams.get('state');
            const device_id = urlParams.get('device_id');
            
            console.log('üü¢ Direct params:', { code, state, device_id });
            
            if (code && window.opener) {
                window.opener.postMessage({
                    code,
                    state,
                    device_id
                }, window.location.origin);
                
                console.log('üü¢ Data sent to parent window');
                
                setTimeout(() => {
                    window.close();
                }, 500);
            }
        }
    </script>
    <p style="text-align: center; padding-top: 50px; font-family: sans-serif; color: #4CAF50;">
        ‚úì –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞<br>
        <small style="color: #666;">–≠—Ç–æ –æ–∫–Ω–æ –∑–∞–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏...</small>
    </p>
</body>
</html>